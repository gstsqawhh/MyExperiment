<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/601535 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="1084"/>

<div>
<span><div>redis序列化和存储方式介绍</div><div>目录：</div><div>1、Java序列化介绍</div><div>2、redis序列化介绍</div><div>3、redisTemplate 序列化方式介绍</div><div><span style="text-decoration: line-through;">4、redis存储方式介绍</span></div><div><br/></div><div>一、Java序列化介绍</div><div>1、Serializable</div><div>Java序列化用于将对象持久化保存，即当程序不运行时，可以将对象经过序列化保存到文件中，当程序重新运行时，将对象从文件反序列化出来，或者将对象序列化后通过网络传输，具体序列化时是将实现了Serializable的接口的对象转换成为一个字节序列。</div><div>Java对象序列化主要是为了Java的两种特性而设计的，一是RMI远程调用，当调用远程对象时，需要通过序列化的方式来传输参数和返回值；另一个是Java Beans，在设计阶段需要对状态信息进行配置，然后再启动阶段后进行反序列化恢复。</div><div>序列化和反序列化方式如下所示，除了通过文件保存序列化后的字节数组，还可以直接通过ByteArrayOutputStream和ByteArrayInputstream来保存字节数组到byte数组中。</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>Object obj = new Object();</div><div>ObjectOutputStream outStream = new ObjectOutoutStream(new FileOutputStream(&quot;obj.out&quot;));</div><div>outStream.write(obj);</div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">outStream.close();</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">ObjectInputstream inStream = new ObjectInputStream(new FileInputStream(&quot;obj.out&quot;));</span></div><div><span style="font-size: 9pt; color: rgb(51, 51, 51); font-family: Monaco;">Object obj1 = inStream.readObject();</span></div></div><div>对象序列化不仅能够保存对象的全部属性和方法，更能够保存引用的对象的属性和方法，可以递归保存。</div><div>如果正在使用Serializable对象，不想使用Externalizable接口来手动管理要序列化的属性，可以通过transient关键字来实现，避免属性被序列化。</div><div>另外需要注意，实现Serializable接口不会自动地去序列化static所修饰的属性，因此需要手动地区write和read static属性。</div><div><br/></div><div>2、Externalizable接口</div><div>如果不希望一些属性或者子对象被序列化，可以通过实现Externalizable接口来实现，该接口有两个方法，writeExternal和readExternal，这两个方法会在序列化和反序列化的过程被自动地调用。使用Externalizable需要注意，在反序列时不是像Serializable那样直接从字节数组恢复，而是会调用实现该接口的类的默认构造方法，因此如果属性需要在writeExternal和readExternal方法中被写入和读取，才能保证正确性。</div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div>public void writeExternal(ObjectOutput out) {</div><div>    out.writeObject(object1);</div><div>    out.writeInt(i);</div><div>}</div><div>public void writeExternal(ObjectInput in) {</div><div>    Object obj1 = in.readObject();</div><div>    int i = in.readInt();</div><div>}</div></div><div><br/></div><div>二、redis序列化协议</div><div>Redis的交互协议分为两部分，一是网络协议，二是序列化协议；</div><div>redis server运行于单独的进程中，网络协议是指redis客户端通过TCP与redis server服务器交互，多个客户端会与server建立多个连接。</div><div>序列化协议是指，客户端和服务器端交互的序列化后的数据的组织方式，协议数据分为不同的类型，每种类型的协议通过数据的首字符区分类型，均以\r\n结尾，包括以下几种类型的协议：</div><div>1、inline command</div><div>这类数据表示redis命令，首字符为redis命令的字符，例如Exist key1，首字符为E</div><div>2、simple string</div><div>首字符为+，后续字符为string的内容，且该string不包含\r和\n两个字符，最后以\r\n结束，simple string中不包括转义，所以客户端的反序列化效率很高。</div><div>3、bulk string</div><div>对于string本身包含了\r和\n的情况，simple string不再适用，解决方案包括两种，转义和长度自描述，转义会使得反序列化的效率变低，所以redis采用的是长度自描述的方式，即bulk string，具体是指首字符为$，后面string数据的长度，紧接着是通过\r\n包裹的字符串内容，内容中可以包括\r和\n等转义字符。</div><div>4、error</div><div>这类数据用于客户端可以简单快速地识别出是正常地执行结果还是异常信息，并对异常信息做相应地处理。</div><div>error数据定义与simple string类似，区别载运simple string是以+号开头，而error是以-开头</div><div>5、integer</div><div>以：字符开头，紧跟着整型数字本身，最后以\r\n结尾。</div><div>6、array</div><div>以*字符开头，紧接着数组地长度，\r\n之后是每个元素地序列化数据，其中元素可以是数组，也就是可以嵌套使用。</div><div>对于上述类型的数据，redis客户端发送给服务端的类型包括：inline command，由bulk string组成的array。</div><div>由redis服务端发送redis客户端的数据包括除了inline command之外的所有数据。</div><div><br/></div><div>三、redis序列化方式</div><div>JdkSerializationRedisSerializer：按照上述所说的Java对象的序列化方式，保存对应的字节数组，默认被RedisCache和RedisTemplate使用；</div><div>StringRedisSerializer：key和value都是String；</div><div>OxmSerializer：用于对象和XML的映射；</div><div>Jackson2JsonRedisSerializer/GenericJackson2JsonRedisSerializer：经数据保存为JSON的格式。</div><div><br/></div><div><span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">TODO</span>：添加redisTemplate 使用serializer的代码</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></span>
</div></body></html> 